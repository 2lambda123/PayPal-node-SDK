// This class was generated on Tue, 19 Sep 2017 17:11:32 UTC by version 0.1 of Braintree SDK Generator
// paymentExecuteRequestTest.js
// DO NOT EDIT
// @type request
// @json {"Name":"payment.execute","Description":"Executes a PayPal payment that the customer has approved. You can optionally update one or more transactions when you execute the payment.\u003cblockquote\u003e\u003cstrong\u003eImportant:\u003c/strong\u003e This call works only after a customer has approved the payment. For more information, learn about [PayPal payments](/docs/integration/direct/payments/paypal-payments/).\u003c/blockquote\u003e","QueryParameters":[],"HeaderParameters":[],"FormParameters":[],"PathParameters":[{"Type":"string","VariableName":"payment_id","Description":"The ID of the payment to execute.","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null}],"RequestType":{"Type":"Payment Execution","VariableName":"body","Description":"Executes a PayPal account-based payment with the `payer_id` obtained from the web approval URL.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"string","VariableName":"payer_id","Description":"The ID of the payer that PayPal passes in the `return_url`.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"Cart","VariableName":"transactions","Description":"The transaction details, including the amount and item details. For update and execute payment calls, the **`transactions`** object accepts only the **`amount`** object.","ArrayType":6,"ReadOnly":false,"Required":false,"Properties":null}]},"ResponseType":{"Type":"Payment","VariableName":"","Description":"A payment. Use this object to create, process, and manage payments.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"string","VariableName":"create_time","Description":"The date and time when the payment was created, in [Internet date and time format](http://tools.ietf.org/html/rfc3339#section-5.6).","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"experience_profile_id","Description":"The PayPal-generated ID for the merchant's payment experience profile. For information, see [create web experience profile](/docs/api/payment-experience/#web-profile_create).","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"failure_reason","Description":"The reason code for a payment failure.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"id","Description":"The ID of the payment.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"intent","Description":"The payment intent. Value is:\u003cul\u003e\u003cli\u003e\u003ccode\u003esale\u003c/code\u003e. Makes an immediate payment.\u003c/li\u003e\u003cli\u003e\u003ccode\u003eauthorize\u003c/code\u003e. [Authorizes a payment for capture later](/docs/integration/direct/payments/capture-payment/).\u003c/li\u003e\u003cli\u003e\u003ccode\u003eorder\u003c/code\u003e. [Creates an order](/docs/integration/direct/payments/orders/).\u003c/li\u003e\u003c/ul\u003e","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null},{"Type":"Link Description Object","VariableName":"links","Description":"","ArrayType":6,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"note_to_payer","Description":"A free-form field that clients can use to send a note to the payer.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"Payer","VariableName":"payer","Description":"A payer that funds a payment.","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":[{"Type":"Funding Instrument","VariableName":"funding_instruments","Description":"A list of funding instruments for the current payment. Required when the `payment_method` is `credit_card` but does not apply when the `payment_method` is `paypal`. For credit card payments, the list must include either a `credit_card` object or `credit_card_token` object. You can specify only one funding instrument for a payment. If you specify more than one instrument in the list, the payment is declined.","ArrayType":6,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"Payer Info","VariableName":"payer_info","Description":"The payer information.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"Address","VariableName":"billing_address","Description":"The billing address in a payment. Can be extended for shipping address.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"string","VariableName":"city","Description":"The city name. Maximum length is 50 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"country_code","Description":"The [two-character country code](https://developer.paypal.com/docs/classic/api/country_codes/).","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null},{"Type":"string","VariableName":"line1","Description":"The first line of the address. For example, number, street, and so on. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null},{"Type":"string","VariableName":"line2","Description":"The second line of the address. For example, suite, apartment number, and so on. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"normalization_status","Description":"The address normalization status. Returned only for payers from Brazil.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"phone","Description":"The phone number, in [E.123 format](https://www.itu.int/rec/T-REC-E.123-200102-I/en). Maximum length is 50 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"postal_code","Description":"The zip code or equivalent. Typically required for countries that have them. Maximum length is 20 characters.**Required in certain countries.**","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"state","Description":"The two-letter code for US states or the equivalent for other countries. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"status","Description":"The address status.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"type","Description":"The type of address. For example, `HOME_OR_WORK`, `GIFT`, and so on.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},{"Type":"string","VariableName":"birth_date","Description":"The birth date of the payer, in [Internet date format](http://tools.ietf.org/html/rfc3339#section-5.6). For example, `1990-04-12`.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"country_code","Description":"The payer's [two-character IS0-3166-1 country code](https://developer.paypal.com/docs/classic/api/country_codes/).","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"email","Description":"The payer's email address. Maximum length is 127 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"first_name","Description":"The payer's first name.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"last_name","Description":"The payer's last name.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"middle_name","Description":"The payer's middle name.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"payer_id","Description":"The PayPal-assigned encrypted payer ID.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"phone","Description":"The payer's phone number. Maximum length is 20 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"phone_type","Description":"The phone type.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"salutation","Description":"The payer's salutation.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"Shipping Address","VariableName":"shipping_address","Description":"The extended address, which is used as the shipping address in a payment.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"string","VariableName":"city","Description":"The city name. Maximum length is 50 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"country_code","Description":"The [two-character country code](https://developer.paypal.com/docs/classic/api/country_codes/).","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null},{"Type":"string","VariableName":"line1","Description":"The first line of the address. For example, number, street, and so on. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":true,"Properties":null},{"Type":"string","VariableName":"line2","Description":"The second line of the address. For example, suite, apartment number, and so on. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"normalization_status","Description":"The address normalization status. Returned only for payers from Brazil.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"phone","Description":"The phone number, in [E.123 format](https://www.itu.int/rec/T-REC-E.123-200102-I/en). Maximum length is 50 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"postal_code","Description":"The zip code or equivalent. Typically required for countries that have them. Maximum length is 20 characters.**Required in certain countries.**","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"recipient_name","Description":"The name of the recipient at this address.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"state","Description":"The two-letter code for US states or the equivalent for other countries. Maximum length is 100 characters.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"status","Description":"The address status.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"type","Description":"The type of address. For example, `HOME_OR_WORK`, `GIFT`, and so on.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},{"Type":"string","VariableName":"suffix","Description":"The payer's suffix.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"tax_id","Description":"The payer’s tax ID. Supported for the PayPal payment method only.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"tax_id_type","Description":"The payer’s tax ID type. Supported for the PayPal payment method only.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},{"Type":"string","VariableName":"payment_method","Description":"The payment method. Value is PayPal Wallet payment, bank direct debit, or direct credit card.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"status","Description":"The status of payer's PayPal account.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},{"Type":"redirect urls","VariableName":"redirect_urls","Description":"A set of redirect URLs that you provide for PayPal-based payments.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":[{"Type":"string","VariableName":"cancel_url","Description":"The URL where the payer is redirected after he or she cancels the payment. **Required for PayPal account payments**.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"return_url","Description":"The URL where the payer is redirected after he or she approves the payment. **Required for PayPal account payments**.","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},{"Type":"string","VariableName":"state","Description":"The state of the payment, authorization, or order transaction. Value is:\u003cul\u003e\u003cli\u003e\u003ccode\u003ecreated\u003c/code\u003e. The transaction was successfully created.\u003c/li\u003e\u003cli\u003e\u003ccode\u003eapproved\u003c/code\u003e. The buyer approved the transaction.\u003c/li\u003e\u003cli\u003e\u003ccode\u003efailed\u003c/code\u003e. The transaction request failed.\u003c/li\u003e\u003c/ul\u003e","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"Transaction","VariableName":"transactions","Description":"An array of payment-related transactions. A transaction defines what the payment is for and who fulfills the payment. For update and execute payment calls, the **`transactions`** object accepts the **`amount`** object only.","ArrayType":6,"ReadOnly":false,"Required":false,"Properties":null},{"Type":"string","VariableName":"update_time","Description":"The date and time when the payment was updated, in [Internet date and time format](http://tools.ietf.org/html/rfc3339#section-5.6).","ArrayType":0,"ReadOnly":false,"Required":false,"Properties":null}]},"ContentType":"application/json","HttpMethod":"POST","Path":"/v1/payments/payment/{payment_id}/execute","ExpectedStatusCode":200,"FileSuffix":"Test","UseFakeInstance":true}

'use strict';

const chai = require('chai');
const client = require('../../test_harness').client();
const PaymentExecuteRequest = require('../../../lib/lib').PaymentExecuteRequest;
const PaymentCreate = require('./paymentCreateRequestTest').PaymentCreate;

function buildRequestBody() {
  return {
    payer_id: 'some-payer-id'
  };
}

describe('PaymentExecuteRequest', function () {
  it('works as expected', function () {
    return PaymentCreate('order', 'paypal').then((createResponse) => {
      let request = new PaymentExecuteRequest(createResponse.result.id);
      request.requestBody(buildRequestBody());

      return client.execute(request).then((r) => {
        chai.assert.fail('This test relies on user approval');
      }).catch((error) => {
        chai.assert.include(error.message, 'PAYMENT_NOT_APPROVED_FOR_EXECUTION');
      });
    });
  });
});
